<h3>스프링 웹 MVC</h3>
<hr/>
<h5>DispatcherServlet 1부</h5>

어떻게해서 dispatcherServlet 을 사용하면 핸들러를 어노테이션으로 작성할 수 있을까?

,디버거를 통해 살펴보자,

DispatcherServlet은 doService를 오버라이딩 해놨는데 여기에 디버거를 걸거야.

여기서 StepOver 기능을 사용하여 한 줄씩 내려가다가 들어가고 싶은 메소드가 있다 StepInto 로 들어가면 돼.

그렇게 doDispatch 로 들어가게되면 우선 먼저 하는 것은 요청을 분석하게 돼. 이게 멀티파트 요청인지 locale 은 어떤건지 테마는 어떤 테마인지 등의 정보를 판단함.

mappedHandler = this.getHandler(processedRequest);

이 요청을 처리할 수 있는 핸들러를 찾아오는 부분인데, 여기서 StepInto 하게 되면 디스패처 서블릿이 들고 있는 여러개의 핸들러 매핑 중에서 기본으로 해주는 2개가 있는데 하나는 빈 네임 url 핸들러 매핑이고 다른 하나는 리퀘스트 매핑 핸들러 매핑이야. 실질적으로 후자가 우리가 지정한 어노테이션을 찾아주는 핸들러야. 그래서 다시 StepOver 를 하게 되면 제일 처음 검사할 핸들러 매핑이 빈네임url핸들러매핑이야. 근데 우리 상황에서는 null 이 나올거야. 그러니까 반복문을 한 번 더 돌게 되고 다음에 가지고 있는 핸들러 매핑 리퀘스트매핑핸들러매핑을 사용해서 핸들러를 찾아와. 그러면 그때 GetMapping을 설정해놓은 것을 찾을 수 있어. 이거를 하고 나면 핸들러는 null 이 아니니까 반복문을 빠져나오겠지. 리턴받은 핸들러는 null 이 아니게되고 다음 작업인 핸들러 어댑터를 찾아와. 이제 핸들러를 실행하는 인터페이스를 찾는거야. 디스패처 서블릿에는 핸들러 매핑 뿐 아니라 어댑터도 여러개 등록되어 있어. 매핑처럼 어댑터도 StepInto 로 들어가.  어댑터는 기본적으로 3개가 있어. HttpRequestHanlderAdapter, SimpleControllerHandlerAdapter, RequestMappingHandlerAdpater. 왠지 마지막이 내 핸들러를 실행할 수 있을거 같아. 반복문을 돌다보면 내 핸들러를 처리할 수 있는 어댑터를 찾게 돼. 그러면 반복문을 빠져나오고 값을 리턴받아. 그러고 나면 이제 요청을 처리해야지. 

handleInternal 안으로 들어가게 되는데, 이 안에서 실제 핸들러 메소드를 invoke 하게 돼. 자바의 리플렉션을 사용해서 핸들러의 컨트롤러를 실행하게 되는거지. 핸들러 메소드 객체 안에는 이미 메소드에 대한 정보가 있어. 이걸 가지고 자바의 리플렉션을 사용해서 메소드를 호출하게 되는거지. 여기서 StepOver 를 하게 되면 핸들러의 컨트롤러로 들어가게 될거야. 핸들러 코드가 실행하게 되는거지. 그리고 리턴받은 값이 다시 돌아가 returnValue 에 담기게 되는거지 . 이 경우에는 RestController 이기 때문에 일반적인 컨트롤러에 @ResponseBody 를 사용한 컨트롤러와 같음. 모든 메소드에 적어주는 것을 생략하기 위해 Rest를 사용하는 것 뿐. 아무튼 returnValue 는 null 이 아니야. 그럼 이제 returnValue 핸들러를 찾아야해. 리턴 값을 어떻게 처리할거야? 에 대한거야. 지금은 @ResponseBody 라는 어노테이션이 붙은 문자열이지만 다양한 리턴값을 줄 수 있거든. 15가지의 핸들러 중에서 11번째에 있는 RequestResponseBodyMethodProcessor 핸들러가 처리할거야. 이 처리는 컨버터를 사용해서 리턴값을 메세지 본문에 http 본문에 넣어주는 처리를 해주는거야. 따라서 응답으로 view 에 렌더링 하는거 없이, 화면에 값이 나오는 것을 볼 수 있음.

(참고, ResponseBody 로 동작할 땐 mv, modelandview 가 null 임)

